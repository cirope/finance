<% if @state.persisted? %>
  if ($('#modal form').length == 1) {
    $('#modal').modal('hide');
  } else {
    $('form.new_state').remove();

    $('#modal .modal-title').text('<%= j t('cities.new.title') %>');
    $('#modal form:last').show().find('[autofocus]').focus();
  }

  $('#city_state_id').html(
    '<%= j options_from_collection_for_select(states, :id, :name, @state.id) %>'
  );
<% else %>
  <%= render template: 'states/new' %>
<% end %>
